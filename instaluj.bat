@echo off
chcp 65001 >nul
setlocal EnableDelayedExpansion

echo.
echo ===============================================================
echo   KSeF API 2.0 -- Instalator
echo   Pobieranie faktur do Excel
echo ===============================================================
echo.

:: ---------------------------------------------------------------
:: 1. Katalog docelowy
:: ---------------------------------------------------------------
set "DEFAULT_DIR=C:\ksef_faktury"
set /p "INSTALL_DIR=Podaj katalog instalacji [domyslnie: %DEFAULT_DIR%]: "
if "!INSTALL_DIR!"=="" set "INSTALL_DIR=%DEFAULT_DIR%"

echo.
echo Katalog: !INSTALL_DIR!
echo.

:: ---------------------------------------------------------------
:: 2. Sprawdzenie Pythona
:: ---------------------------------------------------------------
echo [1/5] Sprawdzanie Pythona...
python --version >nul 2>&1
if %errorlevel% neq 0 (
    echo.
    echo BLAD: Python nie jest zainstalowany lub nie jest w PATH.
    echo Pobierz Python 3.12+ z: https://www.python.org/downloads/
    echo Podczas instalacji zaznacz opcje "Add Python to PATH".
    echo.
    pause
    exit /b 1
)
for /f "tokens=2" %%v in ('python --version 2^>^&1') do set PY_VER=%%v
echo    Python %PY_VER% znaleziony. OK

:: ---------------------------------------------------------------
:: 3. Wyodrebnienie plikow
:: ---------------------------------------------------------------
echo.
echo [2/5] Kopiowanie plikow do: !INSTALL_DIR!
if not exist "!INSTALL_DIR!" mkdir "!INSTALL_DIR!"

:: --- main.py ---
(
echo IiIiCm1haW4ucHkKLS0tLS0tLQpHxYLDs3dueSBza3J5cHQgcHJvamVrdHUgS1NlRiBBUEkgMi4w
echo LgpQb2JpZXJhIGZha3R1cnkgd3lzdGF3aW9uZSBpIG90cnp5bWFuZSwgemFwaXN1amUgZG8gRXhj
echo ZWwuCgpVcnVjaG9taWVuaWU6CiAgICBweXRob24gbWFpbi5weQoKV3ltYWdhbmEga29uZmlndXJh
echo Y2phIHcgcGxpa3UgLmVudiAoc2tvcGl1aiB6IC5lbnYuZXhhbXBsZSkuCiIiIgoKaW1wb3J0IGxv
echo Z2dpbmcKaW1wb3J0IG9zCmltcG9ydCBzeXMKaW1wb3J0IHRpbWUKZnJvbSBwYXRobGliIGltcG9y
echo dCBQYXRoCgpmcm9tIGRvdGVudiBpbXBvcnQgbG9hZF9kb3RlbnYKaW1wb3J0IG9wZW5weXhsCmZy
echo b20gb3BlbnB5eGwuc3R5bGVzIGltcG9ydCBGb250LCBQYXR0ZXJuRmlsbCwgQWxpZ25tZW50CmZy
echo b20gb3BlbnB5eGwudXRpbHMgaW1wb3J0IGdldF9jb2x1bW5fbGV0dGVyCgpmcm9tIGtzZWZfYXV0
echo aCBpbXBvcnQgS1NlRkF1dGgsIEtTZUZBdXRoRXJyb3IKZnJvbSBrc2VmX2ludm9pY2VzIGltcG9y
echo dCBLU2VGSW52b2ljZXMsIEtTZUZJbnZvaWNlRXJyb3IKCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0t
echo LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgS29uZmlndXJh
echo Y2phIGxvZ293YW5pYQojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
echo LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpsb2dnaW5nLmJhc2ljQ29uZmlnKAogICAgbGV2ZWw9
echo bG9nZ2luZy5JTkZPLAogICAgZm9ybWF0PSIlKGFzY3RpbWUpcyAgJShsZXZlbG5hbWUpLThzICAl
echo KG1lc3NhZ2UpcyIsCiAgICBkYXRlZm10PSIlSDolTTolUyIsCikKbG9nZ2VyID0gbG9nZ2luZy5n
echo ZXRMb2dnZXIoX19uYW1lX18pCgojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
echo LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojIFdjenl0YWogLmVudgojIC0tLS0tLS0t
echo LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
echo LQpsb2FkX2RvdGVudihQYXRoKF9fZmlsZV9fKS5wYXJlbnQgLyAiLmVudiIpCgpOSVAgICAgICAg
echo ICAgID0gb3MuZ2V0ZW52KCJLU0VGX05JUCIsICIiKS5zdHJpcCgpClRPS0VOICAgICAgICAgPSBv
echo cy5nZXRlbnYoIktTRUZfVE9LRU4iLCAiIikuc3RyaXAoKQpFTlYgICAgICAgICAgID0gb3MuZ2V0
echo ZW52KCJLU0VGX0VOViIsICJ0ZXN0Iikuc3RyaXAoKS5sb3dlcigpCkRBVEVfRlJPTV9TVFIgPSBv
echo cy5nZXRlbnYoIkRBVEVfRlJPTSIsICIyMDI1LTAxLTAxIikuc3RyaXAoKQpEQVRFX1RPX1NUUiAg
echo ID0gb3MuZ2V0ZW52KCJEQVRFX1RPIiwgICAiMjAyNS0xMi0zMSIpLnN0cmlwKCkKUEFHRV9TSVpF
echo ICAgICA9IGludChvcy5nZXRlbnYoIlBBR0VfU0laRSIsICIxMDAiKSkKCkJBU0VfVVJMUyA9IHsK
echo ICAgICJ0ZXN0IjogImh0dHBzOi8vYXBpLXRlc3Qua3NlZi5tZi5nb3YucGwvYXBpL3YyIiwKICAg
echo ICJwcm9kIjogImh0dHBzOi8vYXBpLmtzZWYubWYuZ292LnBsL2FwaS92MiIsCn0KQkFTRV9VUkwg
echo PSBCQVNFX1VSTFMuZ2V0KEVOViwgQkFTRV9VUkxTWyJ0ZXN0Il0pCgpPVVRQVVRfRklMRSA9IFBh
echo dGgoX19maWxlX18pLnBhcmVudCAvICJmYWt0dXJ5X2tzZWYueGxzeCIKCgojIC0tLS0tLS0tLS0t
echo LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoj
echo IEtvbHVtbnkga3TDs3JlIGNoY2VteSBwb2themHEhyB3IEV4Y2VsdQojIEtsdWN6ZSBvZHBvd2lh
echo ZGFqxIUgcG9sb20gendyYWNhbnltIHByemV6IEtTZUYgQVBJCiMgLS0tLS0tLS0tLS0tLS0tLS0t
echo LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCklOVk9JQ0Vf
echo Q09MVU1OUyA9IFsKICAgICgiX3R5cCIsICAgICAgICAgICJUeXAgZmFrdHVyeSIpLAogICAgKCJr
echo c2VmTnVtYmVyIiwgICAgIk51bWVyIEtTZUYiKSwKICAgICgiaW52b2ljZU51bWJlciIsICJOdW1l
echo ciBmYWt0dXJ5IiksCiAgICAoImludm9pY2VUeXBlIiwgICAiUm9kemFqIGZha3R1cnkiKSwKICAg
echo ICgiaXNzdWVEYXRlIiwgICAgICJEYXRhIHd5c3Rhd2llbmlhIiksCiAgICAoImludm9pY2luZ0Rh
echo dGUiLCAiRGF0YSBwcnp5asSZY2lhIHcgS1NlRiIpLAogICAgKCJzZWxsZXJfbmFtZSIsICAgIld5
echo c3Rhd2NhIOKAlCBuYXp3YSIpLAogICAgKCJzZWxsZXJfbmlwIiwgICAgIld5c3Rhd2NhIOKAlCBO
echo SVAiKSwKICAgICgiYnV5ZXJfbmFtZSIsICAgICJOYWJ5d2NhIOKAlCBuYXp3YSIpLAogICAgKCJi
echo dXllcl9uaXAiLCAgICAgIk5hYnl3Y2Eg4oCUIE5JUCIpLAogICAgKCJuZXRBbW91bnQiLCAgICAg
echo Ikt3b3RhIG5ldHRvIiksCiAgICAoInZhdEFtb3VudCIsICAgICAiS3dvdGEgVkFUIiksCiAgICAo
echo Imdyb3NzQW1vdW50IiwgICAiS3dvdGEgYnJ1dHRvIiksCiAgICAoImN1cnJlbmN5IiwgICAgICAi
echo V2FsdXRhIiksCl0KCgpkZWYgZmxhdHRlbl9pbnZvaWNlKGludjogZGljdCkgLT4gZGljdDoKICAg
echo ICIiIgogICAgU3DFgmFzemN6YSB6YWduaWXFvGTFvG9uZSBwb2xhIGZha3R1cnkgZG8gamVkbm9w
echo b3ppb21vd2VnbyBzxYJvd25pa2EuCiAgICBLU2VGIEFQSSAyLjAgendyYWNhIHNlbGxlci5uYW1l
echo LCBzZWxsZXIubmlwLCBidXllci5uYW1lLCBidXllci5pZGVudGlmaWVyLnZhbHVlIGl0cC4KICAg
echo ICIiIgogICAgZmxhdDogZGljdCA9IHt9CgogICAgZm9yIGtleSwgXyBpbiBJTlZPSUNFX0NPTFVN
echo TlM6CiAgICAgICAgaWYga2V5ID09ICJzZWxsZXJfbmFtZSI6CiAgICAgICAgICAgIGZsYXRba2V5
echo XSA9IChpbnYuZ2V0KCJzZWxsZXIiKSBvciB7fSkuZ2V0KCJuYW1lIiwgIiIpCiAgICAgICAgZWxp
echo ZiBrZXkgPT0gInNlbGxlcl9uaXAiOgogICAgICAgICAgICBmbGF0W2tleV0gPSAoaW52LmdldCgi
echo c2VsbGVyIikgb3Ige30pLmdldCgibmlwIiwgIiIpCiAgICAgICAgZWxpZiBrZXkgPT0gImJ1eWVy
echo X25hbWUiOgogICAgICAgICAgICBmbGF0W2tleV0gPSAoaW52LmdldCgiYnV5ZXIiKSBvciB7fSku
echo Z2V0KCJuYW1lIiwgIiIpCiAgICAgICAgZWxpZiBrZXkgPT0gImJ1eWVyX25pcCI6CiAgICAgICAg
echo ICAgICMgYnV5ZXIuaWRlbnRpZmllci52YWx1ZSAoTklQIG5hYnl3Y3kgemFnbmllxbxkxbxvbnkg
echo Z8WCxJliaWVqKQogICAgICAgICAgICBmbGF0W2tleV0gPSAoKGludi5nZXQoImJ1eWVyIikgb3Ig
echo e30pLmdldCgiaWRlbnRpZmllciIpIG9yIHt9KS5nZXQoInZhbHVlIiwgIiIpCiAgICAgICAgZWxz
echo ZToKICAgICAgICAgICAgZmxhdFtrZXldID0gaW52LmdldChrZXksICIiKQoKICAgIHJldHVybiBm
echo bGF0CgoKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
echo LS0tLS0tLS0tLS0tLS0tLS0KIyBaYXBpcyBkbyBFeGNlbAojIC0tLS0tLS0tLS0tLS0tLS0tLS0t
echo LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpIRUFERVJfRklM
echo TCAgPSBQYXR0ZXJuRmlsbCgic29saWQiLCBmZ0NvbG9yPSIxRjRFNzkiKSAgIyBjaWVtbm9uaWVi
echo aWVza2kKSEVBREVSX0ZPTlQgID0gRm9udChjb2xvcj0iRkZGRkZGIiwgYm9sZD1UcnVlLCBzaXpl
echo PTExKQpBTFRfUk9XX0ZJTEwgPSBQYXR0ZXJuRmlsbCgic29saWQiLCBmZ0NvbG9yPSJENkU0RjAi
echo KSAgIyBqYXNub2LFgsSZa2l0bnkKCgpkZWYgd3JpdGVfc2hlZXQod3MsIGludm9pY2VzOiBsaXN0
echo W2RpY3RdLCB0aXRsZTogc3RyKSAtPiBOb25lOgogICAgIiIiWmFwaXN1amUgbGlzdMSZIGZha3R1
echo ciBkbyBhcmt1c3phIEV4Y2VsIHogZm9ybWF0b3dhbmllbS4iIiIKCiAgICBjb2xfa2V5cyAgID0g
echo W2NbMF0gZm9yIGMgaW4gSU5WT0lDRV9DT0xVTU5TXQogICAgY29sX2xhYmVscyA9IFtjWzFdIGZv
echo ciBjIGluIElOVk9JQ0VfQ09MVU1OU10KCiAgICAjIE5hZ8WCw7N3ZWsKICAgIHdzLmFwcGVuZChj
echo b2xfbGFiZWxzKQogICAgZm9yIGNvbF9pZHgsIF8gaW4gZW51bWVyYXRlKGNvbF9sYWJlbHMsIHN0
echo YXJ0PTEpOgogICAgICAgIGNlbGwgPSB3cy5jZWxsKHJvdz0xLCBjb2x1bW49Y29sX2lkeCkKICAg
echo ICAgICBjZWxsLmZpbGwgPSBIRUFERVJfRklMTAogICAgICAgIGNlbGwuZm9udCA9IEhFQURFUl9G
echo T05UCiAgICAgICAgY2VsbC5hbGlnbm1lbnQgPSBBbGlnbm1lbnQoaG9yaXpvbnRhbD0iY2VudGVy
echo IiwgdmVydGljYWw9ImNlbnRlciIsIHdyYXBfdGV4dD1UcnVlKQoKICAgIHdzLnJvd19kaW1lbnNp
echo b25zWzFdLmhlaWdodCA9IDI4CgogICAgIyBEYW5lCiAgICBmb3Igcm93X2lkeCwgaW52IGluIGVu
echo dW1lcmF0ZShpbnZvaWNlcywgc3RhcnQ9Mik6CiAgICAgICAgZmxhdCA9IGZsYXR0ZW5faW52b2lj
echo ZShpbnYpCiAgICAgICAgZm9yIGNvbF9pZHgsIGtleSBpbiBlbnVtZXJhdGUoY29sX2tleXMsIHN0
echo YXJ0PTEpOgogICAgICAgICAgICBjZWxsID0gd3MuY2VsbChyb3c9cm93X2lkeCwgY29sdW1uPWNv
echo bF9pZHgpCiAgICAgICAgICAgIGNlbGwudmFsdWUgPSBmbGF0LmdldChrZXksICIiKQogICAgICAg
echo ICAgICBjZWxsLmFsaWdubWVudCA9IEFsaWdubWVudCh2ZXJ0aWNhbD0idG9wIiwgd3JhcF90ZXh0
echo PUZhbHNlKQogICAgICAgICAgICBpZiByb3dfaWR4ICUgMiA9PSAwOgogICAgICAgICAgICAgICAg
echo Y2VsbC5maWxsID0gQUxUX1JPV19GSUxMCgogICAgIyBTemVyb2tvxZtjaSBrb2x1bW4KICAgIGNv
echo bHVtbl93aWR0aHMgPSBbMjgsIDM2LCAyMiwgMTgsIDE4LCAyMiwgMzYsIDE2LCAzNiwgMTYsIDE0
echo LCAxNCwgMTQsIDEwXQogICAgZm9yIGNvbF9pZHgsIHdpZHRoIGluIGVudW1lcmF0ZShjb2x1bW5f
echo d2lkdGhzLCBzdGFydD0xKToKICAgICAgICB3cy5jb2x1bW5fZGltZW5zaW9uc1tnZXRfY29sdW1u
echo X2xldHRlcihjb2xfaWR4KV0ud2lkdGggPSB3aWR0aAoKICAgICMgWmFtcm/FvGVuaWUgbmFnxYLD
echo s3drYQogICAgd3MuZnJlZXplX3BhbmVzID0gIkEyIgoKICAgICMgQXV0b2ZpbHRyCiAgICB3cy5h
echo dXRvX2ZpbHRlci5yZWYgPSB3cy5kaW1lbnNpb25zCgoKZGVmIHNhdmVfdG9fZXhjZWwod3lzdGF3
echo aW9uZTogbGlzdFtkaWN0XSwgb3RyenltYW5lOiBsaXN0W2RpY3RdLCBwYXRoOiBQYXRoKSAtPiBO
echo b25lOgogICAgIiIiVHdvcnp5IHBsaWsgRXhjZWwgeiBkd29tYSBhcmt1c3phbWkuIiIiCiAgICB3
echo YiA9IG9wZW5weXhsLldvcmtib29rKCkKCiAgICAjIEFya3VzeiAxIOKAlCBXeXN0YXdpb25lCiAg
echo ICB3czEgPSB3Yi5hY3RpdmUKICAgIHdzMS50aXRsZSA9ICJXeXN0YXdpb25lIgogICAgd3JpdGVf
echo c2hlZXQod3MxLCB3eXN0YXdpb25lLCAiV3lzdGF3aW9uZSIpCgogICAgIyBBcmt1c3ogMiDigJQg
echo T3RyenltYW5lCiAgICB3czIgPSB3Yi5jcmVhdGVfc2hlZXQoIk90cnp5bWFuZSIpCiAgICB3cml0
echo ZV9zaGVldCh3czIsIG90cnp5bWFuZSwgIk90cnp5bWFuZSIpCgogICAgIyBBcmt1c3ogMyDigJQg
echo UG9kc3Vtb3dhbmllCiAgICB3czMgPSB3Yi5jcmVhdGVfc2hlZXQoIlBvZHN1bW93YW5pZSIpCiAg
echo ICB3czMuYXBwZW5kKFsiS1NlRiBBUEkgMi4wIOKAlCBQb2JpZXJhbmllIGZha3R1ciJdKQogICAg
echo d3MzLmFwcGVuZChbXSkKICAgIHdzMy5hcHBlbmQoWyJOSVAgZmlybXk6IiwgICAgICAgTklQXSkK
echo ICAgIHdzMy5hcHBlbmQoWyLFmnJvZG93aXNrbzoiLCAgICAgIEVOVi51cHBlcigpXSkKICAgIHdz
echo My5hcHBlbmQoWyJaYWtyZXMgZGF0OiIsICAgICAgZiJ7REFURV9GUk9NX1NUUn0g4oCUIHtEQVRF
echo X1RPX1NUUn0iXSkKICAgIHdzMy5hcHBlbmQoWyJGYWt0dXIgd3lzdGF3aW9ueWNoOiIsIGxlbih3
echo eXN0YXdpb25lKV0pCiAgICB3czMuYXBwZW5kKFsiRmFrdHVyIG90cnp5bWFueWNoOiIsICBsZW4o
echo b3RyenltYW5lKV0pCiAgICB3czMuYXBwZW5kKFsixYHEhWN6bmllOiIsICAgICAgICAgICAgIGxl
echo bih3eXN0YXdpb25lKSArIGxlbihvdHJ6eW1hbmUpXSkKCiAgICB3czMuY29sdW1uX2RpbWVuc2lv
echo bnNbIkEiXS53aWR0aCA9IDI4CiAgICB3czMuY29sdW1uX2RpbWVuc2lvbnNbIkIiXS53aWR0aCA9
echo IDMwCiAgICB3czNbIkExIl0uZm9udCA9IEZvbnQoYm9sZD1UcnVlLCBzaXplPTE0KQoKICAgIHdi
echo LnNhdmUocGF0aCkKCgojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
echo LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojIE1BSU4KIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0t
echo LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZGVmIG1haW4oKSAt
echo PiBOb25lOgogICAgbG9nZ2VyLmluZm8oIj0iICogNTUpCiAgICBsb2dnZXIuaW5mbygiICBLU2VG
echo IEFQSSAyLjAg4oCUIFBvYmllcmFuaWUgZmFrdHVyIikKICAgIGxvZ2dlci5pbmZvKCI9IiAqIDU1
echo KQoKICAgICMgV2FsaWRhY2phIGtvbmZpZ3VyYWNqaQogICAgaWYgbm90IE5JUCBvciBub3QgVE9L
echo RU46CiAgICAgICAgbG9nZ2VyLmVycm9yKAogICAgICAgICAgICAiQnJhayBrb25maWd1cmFjamkh
echo IFV6dXBlxYJuaWogcGxpayAuZW52IChLU0VGX05JUCBpIEtTRUZfVE9LRU4pLlxuIgogICAgICAg
echo ICAgICAiU2tvcGl1aiAuZW52LmV4YW1wbGUg4oaSIC5lbnYgaSB1enVwZcWCbmlqIHdhcnRvxZtj
echo aS4iCiAgICAgICAgKQogICAgICAgIHN5cy5leGl0KDEpCgogICAgbG9nZ2VyLmluZm8oZiJOSVA6
echo IHtOSVB9IHwgxZpyb2Rvd2lza286IHtFTlYudXBwZXIoKX0gfCBaYWtyZXM6IHtEQVRFX0ZST01f
echo U1RSfSDigJQge0RBVEVfVE9fU1RSfSIpCgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
echo LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICMgMS4gVXdpZXJ6
echo eXRlbG5pZW5pZQogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
echo LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGF1dGggPSBLU2VGQXV0aChuaXA9TklQLCBr
echo c2VmX3Rva2VuPVRPS0VOLCBlbnY9RU5WKQogICAgdHJ5OgogICAgICAgIGF1dGguYXV0aGVudGlj
echo YXRlKCkKICAgIGV4Y2VwdCBLU2VGQXV0aEVycm9yIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9y
echo KGYiQsWCxIVkIHV3aWVyenl0ZWxuaWVuaWE6IHtlfSIpCiAgICAgICAgc3lzLmV4aXQoMSkKCiAg
echo ICBhdXRoX2hlYWRlcnMgPSBhdXRoLmdldF9hdXRoX2hlYWRlcnMoKQogICAgdGltZS5zbGVlcCgx
echo KSAgIyBrcsOzdGtpZSBvcMOzxbpuaWVuaWUgcG8gdXdpZXJ6eXRlbG5pZW5pdQoKICAgICMgLS0t
echo LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
echo LS0tLS0tCiAgICAjIDIuIFByenlnb3Rvd2FuaWUgZGF0IHcgZm9ybWFjaWUgSVNPIDg2MDEKICAg
echo ICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
echo LS0tLS0tLS0tLS0tCiAgICBkYXRlX2Zyb20gPSBLU2VGSW52b2ljZXMudG9faXNvKERBVEVfRlJP
echo TV9TVFIsIGVuZF9vZl9kYXk9RmFsc2UpCiAgICBkYXRlX3RvICAgPSBLU2VGSW52b2ljZXMudG9f
echo aXNvKERBVEVfVE9fU1RSLCAgIGVuZF9vZl9kYXk9VHJ1ZSkKICAgIGxvZ2dlci5pbmZvKGYiWmFr
echo cmVzIGRhdCBJU086IHtkYXRlX2Zyb219ICDihpIgIHtkYXRlX3RvfSIpCgogICAgIyAtLS0tLS0t
echo LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
echo LS0KICAgICMgMy4gUG9iaWVyYW5pZSBmYWt0dXIKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0t
echo LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAjIGF1dGgg
echo cHJ6ZWthemFueSBkbyBrbGllbnRhIOKAlCBvYnPFgnXFvHkgd3lnYcWbbmnEmWNpZSB0b2tlbmEg
echo KDQwMSkgYXV0b21hdHljem5pZQogICAgY2xpZW50ID0gS1NlRkludm9pY2VzKGJhc2VfdXJsPUJB
echo U0VfVVJMLCBhdXRoX2hlYWRlcnM9YXV0aF9oZWFkZXJzLCBwYWdlX3NpemU9UEFHRV9TSVpFLCBh
echo dXRoPWF1dGgpCgogICAgd3lzdGF3aW9uZTogbGlzdFtkaWN0XSA9IFtdCiAgICBvdHJ6eW1hbmU6
echo ICBsaXN0W2RpY3RdID0gW10KCiAgICB0cnk6CiAgICAgICAgbG9nZ2VyLmluZm8oIlxuLS0tIEZB
echo S1RVUlkgV1lTVEFXSU9ORSAtLS0iKQogICAgICAgIHd5c3Rhd2lvbmUgPSBjbGllbnQuZmV0Y2hf
echo YWxsKCJTdWJqZWN0MSIsIGRhdGVfZnJvbSwgZGF0ZV90bykKCiAgICAgICAgbG9nZ2VyLmluZm8o
echo IlxuLS0tIEZBS1RVUlkgT1RSWllNQU5FIC0tLSIpCiAgICAgICAgb3RyenltYW5lID0gY2xpZW50
echo LmZldGNoX2FsbCgiU3ViamVjdDIiLCBkYXRlX2Zyb20sIGRhdGVfdG8pCgogICAgZXhjZXB0IEtT
echo ZUZJbnZvaWNlRXJyb3IgYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZiJCxYLEhWQgcG9iaWVy
echo YW5pYSBmYWt0dXI6IHtlfSIpCiAgICAgICAgc3lzLmV4aXQoMSkKCiAgICAjIC0tLS0tLS0tLS0t
echo LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQog
echo ICAgIyA0LiBaYXBpcyBkbyBFeGNlbAogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
echo LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGxvZ2dlci5pbmZvKGYi
echo XG5aYXBpc3l3YW5pZSBkbyBwbGlrdToge09VVFBVVF9GSUxFLm5hbWV9IC4uLiIpCiAgICBzYXZl
echo X3RvX2V4Y2VsKHd5c3Rhd2lvbmUsIG90cnp5bWFuZSwgT1VUUFVUX0ZJTEUpCgogICAgbG9nZ2Vy
echo LmluZm8oIlxuIiArICI9IiAqIDU1KQogICAgbG9nZ2VyLmluZm8oZiIgIOKckyBHb3Rvd2UhIFBs
echo aWsgemFwaXNhbnk6IHtPVVRQVVRfRklMRX0iKQogICAgbG9nZ2VyLmluZm8oZiIgIEZha3R1ciB3
echo eXN0YXdpb255Y2g6IHtsZW4od3lzdGF3aW9uZSl9IikKICAgIGxvZ2dlci5pbmZvKGYiICBGYWt0
echo dXIgb3RyenltYW55Y2g6ICB7bGVuKG90cnp5bWFuZSl9IikKICAgIGxvZ2dlci5pbmZvKGYiICDF
echo gcSFY3puaWU6ICAgICAgICAgICAgIHtsZW4od3lzdGF3aW9uZSkgKyBsZW4ob3RyenltYW5lKX0i
echo KQogICAgbG9nZ2VyLmluZm8oIj0iICogNTUpCgoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoK
echo ICAgIG1haW4oKQo=
) > "%TEMP%\ksef_main.b64"
certutil -decode "%TEMP%\ksef_main.b64" "!INSTALL_DIR!\main.py" >nul 2>&1
del "%TEMP%\ksef_main.b64"
echo    Wyodrebniono: main.py

:: --- ksef_auth.py ---
(
echo IiIiDQprc2VmX2F1dGgucHkgLSBLU2VGIEFQSSAyLjAgLSB1d2llcnp5dGVsbmllbmllIFRva2Vu
echo ZW0gS1NlRg0KIiIiDQoNCmltcG9ydCBiYXNlNjQNCmltcG9ydCB0aW1lDQppbXBvcnQgbG9nZ2lu
echo Zw0KDQppbXBvcnQgcmVxdWVzdHMNCmZyb20gY3J5cHRvZ3JhcGh5Lmhhem1hdC5wcmltaXRpdmVz
echo IGltcG9ydCBoYXNoZXMsIHNlcmlhbGl6YXRpb24NCmZyb20gY3J5cHRvZ3JhcGh5Lmhhem1hdC5w
echo cmltaXRpdmVzLmFzeW1tZXRyaWMgaW1wb3J0IHBhZGRpbmcNCg0KbG9nZ2VyID0gbG9nZ2luZy5n
echo ZXRMb2dnZXIoX19uYW1lX18pDQoNCkJBU0VfVVJMUyA9IHsNCiAgICAidGVzdCI6ICJodHRwczov
echo L2FwaS10ZXN0LmtzZWYubWYuZ292LnBsL2FwaS92MiIsDQogICAgInByb2QiOiAiaHR0cHM6Ly9h
echo cGkua3NlZi5tZi5nb3YucGwvYXBpL3YyIiwNCn0NCg0KSEVBREVSUyA9IHsNCiAgICAiQ29udGVu
echo dC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLA0KICAgICJBY2NlcHQiOiAiYXBwbGljYXRpb24v
echo anNvbiIsDQp9DQoNCg0KY2xhc3MgS1NlRkF1dGhFcnJvcihFeGNlcHRpb24pOg0KICAgIHBhc3MN
echo Cg0KDQpjbGFzcyBLU2VGQXV0aDoNCg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBuaXA6IHN0ciwg
echo a3NlZl90b2tlbjogc3RyLCBlbnY6IHN0ciA9ICJ0ZXN0Iik6DQogICAgICAgIHNlbGYubmlwID0g
echo bmlwDQogICAgICAgIHNlbGYua3NlZl90b2tlbiA9IGtzZWZfdG9rZW4NCiAgICAgICAgc2VsZi5i
echo YXNlX3VybCA9IEJBU0VfVVJMUy5nZXQoZW52LCBCQVNFX1VSTFNbInRlc3QiXSkNCiAgICAgICAg
echo c2VsZi5hY2Nlc3NfdG9rZW46IHN0ciB8IE5vbmUgPSBOb25lDQogICAgICAgIHNlbGYucmVmcmVz
echo aF90b2tlbjogc3RyIHwgTm9uZSA9IE5vbmUNCg0KICAgIGRlZiBfZ2V0X3B1YmxpY19rZXkoc2Vs
echo ZikgLT4gYnl0ZXM6DQogICAgICAgIHVybCA9IGYie3NlbGYuYmFzZV91cmx9L3NlY3VyaXR5L3B1
echo YmxpYy1rZXktY2VydGlmaWNhdGVzIg0KICAgICAgICByZXNwID0gcmVxdWVzdHMuZ2V0KHVybCwg
echo aGVhZGVycz1IRUFERVJTLCB0aW1lb3V0PTMwKQ0KICAgICAgICBzZWxmLl9yYWlzZV9mb3Jfc3Rh
echo dHVzKHJlc3AsICJCxYLEhWQgcG9iaWVyYW5pYSBrbHVjemEgcHVibGljem5lZ28iKQ0KICAgICAg
echo ICBkYXRhID0gcmVzcC5qc29uKCkNCiAgICAgICAgbG9nZ2VyLmluZm8oZiJLbHVjeiBwdWJsaWN6
echo bnkgUkFXOiB7c3RyKGRhdGEpWzo0MDBdfSIpDQoNCiAgICAgICAgY2VydGlmaWNhdGVzID0gZGF0
echo YSBpZiBpc2luc3RhbmNlKGRhdGEsIGxpc3QpIGVsc2UgZGF0YS5nZXQoImNlcnRpZmljYXRlcyIs
echo IFtdKQ0KICAgICAgICBpZiBub3QgY2VydGlmaWNhdGVzOg0KICAgICAgICAgICAgcmFpc2UgS1Nl
echo RkF1dGhFcnJvcigiQnJhayBjZXJ0eWZpa2F0w7N3IHcgb2Rwb3dpZWR6aSBLU2VGIikNCg0KICAg
echo ICAgICBmaXJzdCA9IGNlcnRpZmljYXRlc1swXQ0KICAgICAgICBsb2dnZXIuaW5mbyhmIktsdWN6
echo IOKAlCBkb3N0xJlwbmUgcG9sYToge2xpc3QoZmlyc3Qua2V5cygpKX0iKQ0KICAgICAgICBkZXJf
echo YjY0ID0gZmlyc3QuZ2V0KCJjZXJ0aWZpY2F0ZSIpIG9yIGZpcnN0LmdldCgidmFsdWUiKSBvciBm
echo aXJzdC5nZXQoInB1YmxpY0tleSIpIG9yICIiDQogICAgICAgIGlmIG5vdCBkZXJfYjY0Og0KICAg
echo ICAgICAgICAgcmFpc2UgS1NlRkF1dGhFcnJvcihmIkJyYWsgZGFueWNoIGNlcnR5ZmlrYXR1LiBQ
echo b2xhOiB7bGlzdChmaXJzdC5rZXlzKCkpfSIpDQogICAgICAgIHJldHVybiBiYXNlNjQuYjY0ZGVj
echo b2RlKGRlcl9iNjQpDQoNCiAgICBkZWYgX2dldF9jaGFsbGVuZ2Uoc2VsZikgLT4gZGljdDoNCiAg
echo ICAgICAgdXJsID0gZiJ7c2VsZi5iYXNlX3VybH0vYXV0aC9jaGFsbGVuZ2UiDQogICAgICAgIHJl
echo c3AgPSByZXF1ZXN0cy5wb3N0KHVybCwganNvbj17fSwgaGVhZGVycz1IRUFERVJTLCB0aW1lb3V0
echo PTMwKQ0KICAgICAgICBzZWxmLl9yYWlzZV9mb3Jfc3RhdHVzKHJlc3AsICJCxYLEhWQgcG9iaWVy
echo YW5pYSBjaGFsbGVuZ2UiKQ0KICAgICAgICBkYXRhID0gcmVzcC5qc29uKCkNCiAgICAgICAgbG9n
echo Z2VyLmluZm8oZiJDaGFsbGVuZ2UgUkFXOiB7ZGF0YX0iKQ0KICAgICAgICByZXR1cm4gZGF0YQ0K
echo DQogICAgZGVmIF9lbmNyeXB0X3Rva2VuKHNlbGYsIHB1YmxpY19rZXlfZGVyOiBieXRlcywgdGlt
echo ZXN0YW1wX21zOiBpbnQpIC0+IHN0cjoNCiAgICAgICAgcGxhaW50ZXh0ID0gZiJ7c2VsZi5rc2Vm
echo X3Rva2VufXx7dGltZXN0YW1wX21zfSIuZW5jb2RlKCJ1dGYtOCIpDQogICAgICAgIHRyeToNCiAg
echo ICAgICAgICAgIHB1YmxpY19rZXkgPSBzZXJpYWxpemF0aW9uLmxvYWRfZGVyX3B1YmxpY19rZXko
echo cHVibGljX2tleV9kZXIpDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICAgICBm
echo cm9tIGNyeXB0b2dyYXBoeSBpbXBvcnQgeDUwOQ0KICAgICAgICAgICAgY2VydCA9IHg1MDkubG9h
echo ZF9kZXJfeDUwOV9jZXJ0aWZpY2F0ZShwdWJsaWNfa2V5X2RlcikNCiAgICAgICAgICAgIHB1Ymxp
echo Y19rZXkgPSBjZXJ0LnB1YmxpY19rZXkoKQ0KICAgICAgICBlbmNyeXB0ZWQgPSBwdWJsaWNfa2V5
echo LmVuY3J5cHQoDQogICAgICAgICAgICBwbGFpbnRleHQsDQogICAgICAgICAgICBwYWRkaW5nLk9B
echo RVAoDQogICAgICAgICAgICAgICAgbWdmPXBhZGRpbmcuTUdGMShhbGdvcml0aG09aGFzaGVzLlNI
echo QTI1NigpKSwNCiAgICAgICAgICAgICAgICBhbGdvcml0aG09aGFzaGVzLlNIQTI1NigpLA0KICAg
echo ICAgICAgICAgICAgIGxhYmVsPU5vbmUsDQogICAgICAgICAgICApLA0KICAgICAgICApDQogICAg
echo ICAgIHJldHVybiBiYXNlNjQuYjY0ZW5jb2RlKGVuY3J5cHRlZCkuZGVjb2RlKCJhc2NpaSIpDQoN
echo CiAgICBkZWYgX3NlbmRfa3NlZl90b2tlbihzZWxmLCBjaGFsbGVuZ2U6IHN0ciwgZW5jcnlwdGVk
echo X3Rva2VuOiBzdHIpIC0+IGRpY3Q6DQogICAgICAgIHVybCA9IGYie3NlbGYuYmFzZV91cmx9L2F1
echo dGgva3NlZi10b2tlbiINCiAgICAgICAgYm9keSA9IHsNCiAgICAgICAgICAgICJjaGFsbGVuZ2Ui
echo OiBjaGFsbGVuZ2UsDQogICAgICAgICAgICAiY29udGV4dElkZW50aWZpZXIiOiB7InR5cGUiOiAi
echo TmlwIiwgInZhbHVlIjogc2VsZi5uaXB9LA0KICAgICAgICAgICAgImVuY3J5cHRlZFRva2VuIjog
echo ZW5jcnlwdGVkX3Rva2VuLA0KICAgICAgICB9DQogICAgICAgIHJlc3AgPSByZXF1ZXN0cy5wb3N0
echo KHVybCwganNvbj1ib2R5LCBoZWFkZXJzPUhFQURFUlMsIHRpbWVvdXQ9MzApDQogICAgICAgIHNl
echo bGYuX3JhaXNlX2Zvcl9zdGF0dXMocmVzcCwgIkLFgsSFZCB3eXN5xYJhbmlhIHRva2VuYSBLU2VG
echo IikNCiAgICAgICAgZGF0YSA9IHJlc3AuanNvbigpDQogICAgICAgIGxvZ2dlci5pbmZvKGYiU2Vu
echo ZEtzZWZUb2tlbiBSQVc6IHtkYXRhfSIpDQogICAgICAgIHJldHVybiBkYXRhDQoNCiAgICBkZWYg
echo X3dhaXRfZm9yX2F1dGgoc2VsZiwgcmVmZXJlbmNlX251bWJlcjogc3RyLCBhdXRoX3Rva2VuOiBz
echo dHIsDQogICAgICAgICAgICAgICAgICAgICAgIG1heF9yZXRyaWVzOiBpbnQgPSAxNSwgc2xlZXBf
echo czogZmxvYXQgPSAxLjUpIC0+IE5vbmU6DQogICAgICAgIHVybCA9IGYie3NlbGYuYmFzZV91cmx9
echo L2F1dGgve3JlZmVyZW5jZV9udW1iZXJ9Ig0KICAgICAgICBiZWFyZXJfaGVhZGVycyA9IHsqKkhF
echo QURFUlMsICJBdXRob3JpemF0aW9uIjogZiJCZWFyZXIge2F1dGhfdG9rZW59In0NCg0KICAgICAg
echo ICBmb3IgYXR0ZW1wdCBpbiByYW5nZSgxLCBtYXhfcmV0cmllcyArIDEpOg0KICAgICAgICAgICAg
echo cmVzcCA9IHJlcXVlc3RzLmdldCh1cmwsIGhlYWRlcnM9YmVhcmVyX2hlYWRlcnMsIHRpbWVvdXQ9
echo MzApDQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIkF1dGggSFRUUCB7cmVzcC5zdGF0dXNfY29k
echo ZX0gKHByw7NiYSB7YXR0ZW1wdH0pOiB7cmVzcC50ZXh0WzozMDBdfSIpDQoNCiAgICAgICAgICAg
echo IGlmIHJlc3Auc3RhdHVzX2NvZGUgPT0gMjAwOg0KICAgICAgICAgICAgICAgIGRhdGEgPSByZXNw
echo Lmpzb24oKQ0KICAgICAgICAgICAgICAgICMgQVBJIDIuMDogc3RhdHVzID0geyJjb2RlIjogMjAw
echo LCAiZGVzY3JpcHRpb24iOiAiLi4uIn0NCiAgICAgICAgICAgICAgICBzdGF0dXNfb2JqID0gZGF0
echo YS5nZXQoInN0YXR1cyIsIHt9KQ0KICAgICAgICAgICAgICAgIHN0YXR1c19jb2RlID0gc3RhdHVz
echo X29iai5nZXQoImNvZGUiLCAwKQ0KDQogICAgICAgICAgICAgICAgaWYgc3RhdHVzX2NvZGUgPT0g
echo MjAwOg0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygi4pyTIFV3aWVyenl0ZWxuaWVu
echo aWUgcG90d2llcmR6b25lIChrb2QgMjAwKSIpDQogICAgICAgICAgICAgICAgICAgIHJldHVybg0K
echo ICAgICAgICAgICAgICAgIGlmIHN0YXR1c19jb2RlID49IDQwMDoNCiAgICAgICAgICAgICAgICAg
echo ICAgZGVzYyA9IHN0YXR1c19vYmouZ2V0KCJkZXNjcmlwdGlvbiIsICIiKQ0KICAgICAgICAgICAg
echo ICAgICAgICBkZXRhaWxzID0gc3RhdHVzX29iai5nZXQoImRldGFpbHMiLCBbXSkNCiAgICAgICAg
echo ICAgICAgICAgICAgcmFpc2UgS1NlRkF1dGhFcnJvcigNCiAgICAgICAgICAgICAgICAgICAgICAg
echo IGYiVXdpZXJ6eXRlbG5pZW5pZSBvZHJ6dWNvbmUgKGtvZCB7c3RhdHVzX2NvZGV9KToge2Rlc2N9
echo IHwge2RldGFpbHN9Ig0KICAgICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgbG9n
echo Z2VyLmluZm8oZiJBdXRoIHcgdG9rdSwgc3RhdHVzPXtzdGF0dXNfY29kZX0gKHByw7NiYSB7YXR0
echo ZW1wdH0pLi4uIikNCg0KICAgICAgICAgICAgZWxpZiByZXNwLnN0YXR1c19jb2RlID09IDIwMjoN
echo CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIkF1dGggdyB0b2t1IEhUVFAgMjAyIChwcsOz
echo YmEge2F0dGVtcHR9KS4uLiIpDQoNCiAgICAgICAgICAgIHRpbWUuc2xlZXAoc2xlZXBfcykNCg0K
echo ICAgICAgICByYWlzZSBLU2VGQXV0aEVycm9yKCJQcnpla3JvY3pvbm8gbGltaXQgcHLDs2Igb2N6
echo ZWtpd2FuaWEgbmEgdXdpZXJ6eXRlbG5pZW5pZSIpDQoNCiAgICBkZWYgX3JlZGVlbV90b2tlbihz
echo ZWxmLCBhdXRoX3Rva2VuOiBzdHIpIC0+IGRpY3Q6DQogICAgICAgIHVybCA9IGYie3NlbGYuYmFz
echo ZV91cmx9L2F1dGgvdG9rZW4vcmVkZWVtIg0KICAgICAgICBiZWFyZXJfaGVhZGVycyA9IHsqKkhF
echo QURFUlMsICJBdXRob3JpemF0aW9uIjogZiJCZWFyZXIge2F1dGhfdG9rZW59In0NCiAgICAgICAg
echo cmVzcCA9IHJlcXVlc3RzLnBvc3QodXJsLCBqc29uPXt9LCBoZWFkZXJzPWJlYXJlcl9oZWFkZXJz
echo LCB0aW1lb3V0PTMwKQ0KICAgICAgICBzZWxmLl9yYWlzZV9mb3Jfc3RhdHVzKHJlc3AsICJCxYLE
echo hWQgd3ltaWFueSB0b2tlbmEgbmEgYWNjZXNzVG9rZW4iKQ0KICAgICAgICBkYXRhID0gcmVzcC5q
echo c29uKCkNCiAgICAgICAgbG9nZ2VyLmluZm8oZiJSZWRlZW0gUkFXOiB7c3RyKGRhdGEpWzozMDBd
echo fSIpDQogICAgICAgIHJldHVybiBkYXRhDQoNCiAgICBkZWYgYXV0aGVudGljYXRlKHNlbGYpIC0+
echo IHN0cjoNCiAgICAgICAgbG9nZ2VyLmluZm8oIktyb2sgMS82OiBQb2JpZXJhbmllIGtsdWN6YSBw
echo dWJsaWN6bmVnbyBLU2VGLi4uIikNCiAgICAgICAgcHVibGljX2tleV9kZXIgPSBzZWxmLl9nZXRf
echo cHVibGljX2tleSgpDQoNCiAgICAgICAgbG9nZ2VyLmluZm8oIktyb2sgMi82OiBQb2JpZXJhbmll
echo IGNoYWxsZW5nZS4uLiIpDQogICAgICAgIGNoYWxsZW5nZV9yZXNwID0gc2VsZi5fZ2V0X2NoYWxs
echo ZW5nZSgpDQogICAgICAgIGxvZ2dlci5pbmZvKGYiQ2hhbGxlbmdlIGtsdWN6ZToge2xpc3QoY2hh
echo bGxlbmdlX3Jlc3Aua2V5cygpKX0iKQ0KDQogICAgICAgIGNoYWxsZW5nZV9pZCA9ICgNCiAgICAg
echo ICAgICAgIGNoYWxsZW5nZV9yZXNwLmdldCgiY2hhbGxlbmdlIikNCiAgICAgICAgICAgIG9yIGNo
echo YWxsZW5nZV9yZXNwLmdldCgicmVmZXJlbmNlTnVtYmVyIikNCiAgICAgICAgICAgIG9yIGNoYWxs
echo ZW5nZV9yZXNwLmdldCgiY2hhbGxlbmdlS2V5IikNCiAgICAgICAgKQ0KICAgICAgICBpZiBub3Qg
echo Y2hhbGxlbmdlX2lkOg0KICAgICAgICAgICAgcmFpc2UgS1NlRkF1dGhFcnJvcihmIkJyYWsgY2hh
echo bGxlbmdlIElELiBLbHVjemU6IHtsaXN0KGNoYWxsZW5nZV9yZXNwLmtleXMoKSl9IikNCg0KICAg
echo ICAgICB0aW1lc3RhbXBfbXMgPSAoDQogICAgICAgICAgICBjaGFsbGVuZ2VfcmVzcC5nZXQoInRp
echo bWVzdGFtcE1zIikNCiAgICAgICAgICAgIG9yIGNoYWxsZW5nZV9yZXNwLmdldCgidGltZXN0YW1w
echo IikNCiAgICAgICAgICAgIG9yIGludCh0aW1lLnRpbWUoKSAqIDEwMDApDQogICAgICAgICkNCiAg
echo ICAgICAgbG9nZ2VyLmluZm8oZiJjaGFsbGVuZ2U9e2NoYWxsZW5nZV9pZH0gfCB0aW1lc3RhbXBN
echo cz17dGltZXN0YW1wX21zfSIpDQoNCiAgICAgICAgbG9nZ2VyLmluZm8oIktyb2sgMy82OiBTenlm
echo cm93YW5pZSB0b2tlbmEgS1NlRiAoUlNBLU9BRVAgU0hBLTI1NikuLi4iKQ0KICAgICAgICBlbmNy
echo eXB0ZWRfdG9rZW4gPSBzZWxmLl9lbmNyeXB0X3Rva2VuKHB1YmxpY19rZXlfZGVyLCB0aW1lc3Rh
echo bXBfbXMpDQoNCiAgICAgICAgbG9nZ2VyLmluZm8oIktyb2sgNC82OiBXeXN5xYJhbmllIHphc3p5
echo ZnJvd2FuZWdvIHRva2VuYS4uLiIpDQogICAgICAgIGF1dGhfcmVzcCA9IHNlbGYuX3NlbmRfa3Nl
echo Zl90b2tlbihjaGFsbGVuZ2VfaWQsIGVuY3J5cHRlZF90b2tlbikNCg0KICAgICAgICBhdXRoX3Jl
echo ZiA9IGF1dGhfcmVzcC5nZXQoInJlZmVyZW5jZU51bWJlciIpIG9yIGF1dGhfcmVzcC5nZXQoImNo
echo YWxsZW5nZSIpIG9yIGNoYWxsZW5nZV9pZA0KICAgICAgICBhdXRoX3Rva2VuX3ZhbHVlID0gKA0K
echo ICAgICAgICAgICAgYXV0aF9yZXNwLmdldCgiYXV0aGVudGljYXRpb25Ub2tlbiIsIHt9KS5nZXQo
echo InRva2VuIikNCiAgICAgICAgICAgIG9yIGF1dGhfcmVzcC5nZXQoInRva2VuIikNCiAgICAgICAg
echo KQ0KICAgICAgICBpZiBub3QgYXV0aF90b2tlbl92YWx1ZToNCiAgICAgICAgICAgIHJhaXNlIEtT
echo ZUZBdXRoRXJyb3IoZiJCcmFrIGF1dGhlbnRpY2F0aW9uVG9rZW4uIEtsdWN6ZToge2xpc3QoYXV0
echo aF9yZXNwLmtleXMoKSl9IikNCg0KICAgICAgICBsb2dnZXIuaW5mbygiS3JvayA1LzY6IE9jemVr
echo aXdhbmllIG5hIHBvdHdpZXJkemVuaWUgdXdpZXJ6eXRlbG5pZW5pYS4uLiIpDQogICAgICAgIHNl
echo bGYuX3dhaXRfZm9yX2F1dGgoYXV0aF9yZWYsIGF1dGhfdG9rZW5fdmFsdWUpDQoNCiAgICAgICAg
echo bG9nZ2VyLmluZm8oIktyb2sgNi82OiBQb2JpZXJhbmllIGFjY2Vzc1Rva2VuIChKV1QpLi4uIikN
echo CiAgICAgICAgdG9rZW5zID0gc2VsZi5fcmVkZWVtX3Rva2VuKGF1dGhfdG9rZW5fdmFsdWUpDQog
echo ICAgICAgICMgYWNjZXNzVG9rZW4gbW/FvGUgYnnEhyBzdHJpbmdpZW0gTFVCIG9iaWVrdGVtIHsi
echo dG9rZW4iOiAiZXlKLi4uIn0NCiAgICAgICAgYWNjZXNzID0gdG9rZW5zLmdldCgiYWNjZXNzVG9r
echo ZW4iKSBvciB0b2tlbnMuZ2V0KCJ0b2tlbiIpDQogICAgICAgIGlmIGlzaW5zdGFuY2UoYWNjZXNz
echo LCBkaWN0KToNCiAgICAgICAgICAgIHNlbGYuYWNjZXNzX3Rva2VuID0gYWNjZXNzLmdldCgidG9r
echo ZW4iKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgc2VsZi5hY2Nlc3NfdG9rZW4gPSBhY2Nl
echo c3MNCg0KICAgICAgICByZWZyZXNoID0gdG9rZW5zLmdldCgicmVmcmVzaFRva2VuIikNCiAgICAg
echo ICAgaWYgaXNpbnN0YW5jZShyZWZyZXNoLCBkaWN0KToNCiAgICAgICAgICAgIHNlbGYucmVmcmVz
echo aF90b2tlbiA9IHJlZnJlc2guZ2V0KCJ0b2tlbiIpDQogICAgICAgIGVsc2U6DQogICAgICAgICAg
echo ICBzZWxmLnJlZnJlc2hfdG9rZW4gPSByZWZyZXNoDQoNCiAgICAgICAgaWYgbm90IHNlbGYuYWNj
echo ZXNzX3Rva2VuOg0KICAgICAgICAgICAgcmFpc2UgS1NlRkF1dGhFcnJvcihmIkJyYWsgYWNjZXNz
echo VG9rZW4uIEtsdWN6ZToge2xpc3QodG9rZW5zLmtleXMoKSl9LCB3YXJ0b8WbxIc6IHt0b2tlbnMu
echo Z2V0KCdhY2Nlc3NUb2tlbicpfSIpDQoNCiAgICAgICAgbG9nZ2VyLmluZm8oIuKckyBVd2llcnp5
echo dGVsbmllbmllIHpha2/FhGN6b25lIHN1a2Nlc2VtLiIpDQogICAgICAgIHJldHVybiBzZWxmLmFj
echo Y2Vzc190b2tlbg0KDQogICAgZGVmIHJlZnJlc2goc2VsZikgLT4gc3RyOg0KICAgICAgICBpZiBu
echo b3Qgc2VsZi5yZWZyZXNoX3Rva2VuOg0KICAgICAgICAgICAgcmFpc2UgS1NlRkF1dGhFcnJvcigi
echo QnJhayByZWZyZXNoVG9rZW4g4oCUIHd5a29uYWogbmFqcGllcncgYXV0aGVudGljYXRlKCkiKQ0K
echo ICAgICAgICB1cmwgPSBmIntzZWxmLmJhc2VfdXJsfS9hdXRoL3Rva2VuL3JlZnJlc2giDQogICAg
echo ICAgIHJlc3AgPSByZXF1ZXN0cy5wb3N0KHVybCwganNvbj17InJlZnJlc2hUb2tlbiI6IHNlbGYu
echo cmVmcmVzaF90b2tlbn0sIGhlYWRlcnM9SEVBREVSUywgdGltZW91dD0zMCkNCiAgICAgICAgc2Vs
echo Zi5fcmFpc2VfZm9yX3N0YXR1cyhyZXNwLCAiQsWCxIVkIG9kxZt3aWXFvGFuaWEgYWNjZXNzVG9r
echo ZW4iKQ0KICAgICAgICBkYXRhID0gcmVzcC5qc29uKCkNCiAgICAgICAgYWNjZXNzID0gZGF0YS5n
echo ZXQoImFjY2Vzc1Rva2VuIikgb3IgZGF0YS5nZXQoInRva2VuIikNCiAgICAgICAgc2VsZi5hY2Nl
echo c3NfdG9rZW4gPSBhY2Nlc3MuZ2V0KCJ0b2tlbiIpIGlmIGlzaW5zdGFuY2UoYWNjZXNzLCBkaWN0
echo KSBlbHNlIGFjY2Vzcw0KICAgICAgICByZWZyZXNoID0gZGF0YS5nZXQoInJlZnJlc2hUb2tlbiIs
echo IHNlbGYucmVmcmVzaF90b2tlbikNCiAgICAgICAgc2VsZi5yZWZyZXNoX3Rva2VuID0gcmVmcmVz
echo aC5nZXQoInRva2VuIikgaWYgaXNpbnN0YW5jZShyZWZyZXNoLCBkaWN0KSBlbHNlIHJlZnJlc2gN
echo CiAgICAgICAgbG9nZ2VyLmluZm8oIuKckyBhY2Nlc3NUb2tlbiBvZMWbd2llxbxvbnkuIikNCiAg
echo ICAgICAgcmV0dXJuIHNlbGYuYWNjZXNzX3Rva2VuDQoNCiAgICBkZWYgZ2V0X2F1dGhfaGVhZGVy
echo cyhzZWxmKSAtPiBkaWN0Og0KICAgICAgICBpZiBub3Qgc2VsZi5hY2Nlc3NfdG9rZW46DQogICAg
echo ICAgICAgICByYWlzZSBLU2VGQXV0aEVycm9yKCJCcmFrIGFjY2Vzc1Rva2VuIOKAlCB3eWtvbmFq
echo IG5hanBpZXJ3IGF1dGhlbnRpY2F0ZSgpIikNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAg
echo ICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsDQogICAgICAgICAgICAiQWNjZXB0
echo IjogImFwcGxpY2F0aW9uL2pzb24iLA0KICAgICAgICAgICAgIkF1dGhvcml6YXRpb24iOiBmIkJl
echo YXJlciB7c2VsZi5hY2Nlc3NfdG9rZW59IiwNCiAgICAgICAgfQ0KDQogICAgQHN0YXRpY21ldGhv
echo ZA0KICAgIGRlZiBfcmFpc2VfZm9yX3N0YXR1cyhyZXNwOiByZXF1ZXN0cy5SZXNwb25zZSwgY29u
echo dGV4dDogc3RyKSAtPiBOb25lOg0KICAgICAgICBpZiBub3QgcmVzcC5vazoNCiAgICAgICAgICAg
echo IHRyeToNCiAgICAgICAgICAgICAgICBkZXRhaWwgPSByZXNwLmpzb24oKQ0KICAgICAgICAgICAg
echo ZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgICAgICAgICBkZXRhaWwgPSByZXNwLnRleHRbOjUw
echo MF0NCiAgICAgICAgICAgIHJhaXNlIEtTZUZBdXRoRXJyb3IoZiJ7Y29udGV4dH0g4oCUIEhUVFAg
echo e3Jlc3Auc3RhdHVzX2NvZGV9OiB7ZGV0YWlsfSIp
) > "%TEMP%\ksef_auth.b64"
certutil -decode "%TEMP%\ksef_auth.b64" "!INSTALL_DIR!\ksef_auth.py" >nul 2>&1
del "%TEMP%\ksef_auth.b64"
echo    Wyodrebniono: ksef_auth.py

:: --- ksef_invoices.py ---
(
echo IiIiCmtzZWZfaW52b2ljZXMucHkKLS0tLS0tLS0tLS0tLS0tLQpNb2R1xYIgcG9iaWVyYW5pYSBs
echo aXN0eSBmYWt0dXIgeiBLU2VGIEFQSSAyLjAuCgpFbmRwb2ludDogUE9TVCAvaW52b2ljZXMvcXVl
echo cnkvbWV0YWRhdGEKTGltaXQgcHJvZHVrY3lqbnk6IDIwIHJlcS9oIChzbGlkaW5nIHdpbmRvdyku
echo ClNrcnlwdCBhdXRvbWF0eWN6bmllIGR6aWVsaSBkxYJ1Z2kgemFrcmVzIG5hIG9rbmEgMy1taWVz
echo acSZY3puZSBpIGN6ZWthCjE4NSBzIG1pxJlkenkgb2tuYW1pLCBhYnkgem1pZcWbY2nEhyBzacSZ
echo IHcgbGltaWNpZSAyMCByZXEvaC4KIiIiCgppbXBvcnQgbG9nZ2luZwppbXBvcnQgdGltZQpmcm9t
echo IGRhdGV0aW1lIGltcG9ydCBkYXRldGltZSwgZGF0ZSwgdGltZWRlbHRhCmZyb20gZGF0ZXV0aWwu
echo cmVsYXRpdmVkZWx0YSBpbXBvcnQgcmVsYXRpdmVkZWx0YQoKaW1wb3J0IHJlcXVlc3RzCgpsb2dn
echo ZXIgPSBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXykKCiMgTGltaXQgcHJvZHVrY3lqbnk6IDIw
echo IHJlcS9oIOKGkiAzNjAwLzIwID0gMTgwIHMvcmVxOyArNSBzIG1hcmdpbmVzIGJlenBpZWN6ZcWE
echo c3R3YQpTTEVFUF9CRVRXRUVOX1dJTkRPV1MgPSAxODUgICMgcwoKU1VCSkVDVF9UWVBFX0xBQkVM
echo UyA9IHsKICAgICJTdWJqZWN0MSI6ICJXeXN0YXdpb25lIChzcHJ6ZWRhxbwpIiwKICAgICJTdWJq
echo ZWN0MiI6ICJPdHJ6eW1hbmUgKHpha3VweS9rb3N6dHkpIiwKfQoKCmNsYXNzIEtTZUZJbnZvaWNl
echo RXJyb3IoRXhjZXB0aW9uKToKICAgIHBhc3MKCgpjbGFzcyBLU2VGSW52b2ljZXM6CgogICAgZGVm
echo IF9faW5pdF9fKHNlbGYsIGJhc2VfdXJsOiBzdHIsIGF1dGhfaGVhZGVyczogZGljdCwgcGFnZV9z
echo aXplOiBpbnQgPSAxMDAsIGF1dGg9Tm9uZSk6CiAgICAgICAgc2VsZi5iYXNlX3VybCA9IGJhc2Vf
echo dXJsCiAgICAgICAgc2VsZi5hdXRoX2hlYWRlcnMgPSBhdXRoX2hlYWRlcnMKICAgICAgICBzZWxm
echo LnBhZ2Vfc2l6ZSA9IG1pbihtYXgocGFnZV9zaXplLCAxKSwgMTAwMCkKICAgICAgICBzZWxmLmF1
echo dGggPSBhdXRoICAjIEtTZUZBdXRoIOKAlCBkbyBhdXRvLW9kxZt3aWXFvGVuaWEgdG9rZW5hIHBy
echo enkgNDAxCgogICAgZGVmIF9xdWVyeV9wYWdlKHNlbGYsIHN1YmplY3RfdHlwZTogc3RyLCBkYXRl
echo X2Zyb206IHN0ciwgZGF0ZV90bzogc3RyLAogICAgICAgICAgICAgICAgICAgIHBhZ2Vfb2Zmc2V0
echo OiBpbnQpIC0+IGRpY3Q6CiAgICAgICAgIiIiUG9iaWVyYSBqZWRuxIUgc3Ryb27EmSB3eW5pa8Oz
echo dyB6IC9pbnZvaWNlcy9xdWVyeS9tZXRhZGF0YSIiIgogICAgICAgIHVybCA9IGYie3NlbGYuYmFz
echo ZV91cmx9L2ludm9pY2VzL3F1ZXJ5L21ldGFkYXRhIgogICAgICAgIHBhcmFtcyA9IHsKICAgICAg
echo ICAgICAgInBhZ2VTaXplIjogc2VsZi5wYWdlX3NpemUsCiAgICAgICAgICAgICJwYWdlT2Zmc2V0
echo IjogcGFnZV9vZmZzZXQsCiAgICAgICAgfQogICAgICAgIGJvZHkgPSB7CiAgICAgICAgICAgICJz
echo dWJqZWN0VHlwZSI6IHN1YmplY3RfdHlwZSwKICAgICAgICAgICAgImRhdGVSYW5nZSI6IHsKICAg
echo ICAgICAgICAgICAgICJkYXRlVHlwZSI6ICJJbnZvaWNpbmciLAogICAgICAgICAgICAgICAgImZy
echo b20iOiBkYXRlX2Zyb20sCiAgICAgICAgICAgICAgICAidG8iOiBkYXRlX3RvLAogICAgICAgICAg
echo ICB9LAogICAgICAgIH0KICAgICAgICBmb3IgYXR0ZW1wdCBpbiByYW5nZSgxLCA2KToKICAgICAg
echo ICAgICAgcmVzcCA9IHJlcXVlc3RzLnBvc3QodXJsLCBqc29uPWJvZHksIHBhcmFtcz1wYXJhbXMs
echo IGhlYWRlcnM9c2VsZi5hdXRoX2hlYWRlcnMsIHRpbWVvdXQ9NjApCiAgICAgICAgICAgIGlmIHJl
echo c3Auc3RhdHVzX2NvZGUgPT0gNDAxIGFuZCBzZWxmLmF1dGggaXMgbm90IE5vbmU6CiAgICAgICAg
echo ICAgICAgICAjIFRva2VuIHd5Z2FzxYIg4oCUIHJlLWF1dGggdyBtaWVqc2N1LCBiZXogdXRyYXR5
echo IHBvc3TEmXB1CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmImFjY2Vzc1Rva2VuIHd5
echo Z2FzxYIgKHByw7NiYSB7YXR0ZW1wdH0vNSkg4oCUIHBvbm93bmUgdXdpZXJ6eXRlbG5pZW5pZS4u
echo LiIpCiAgICAgICAgICAgICAgICBzZWxmLmF1dGguYXV0aGVudGljYXRlKCkKICAgICAgICAgICAg
echo ICAgIHNlbGYuYXV0aF9oZWFkZXJzID0gc2VsZi5hdXRoLmdldF9hdXRoX2hlYWRlcnMoKQogICAg
echo ICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgaWYgcmVzcC5zdGF0dXNfY29kZSA9PSA0
echo Mjk6CiAgICAgICAgICAgICAgICAjIEN6eXRhaiBSZXRyeS1BZnRlciB6IG5hZ8WCw7N3a2EgSFRU
echo UCAoc3RhbmRhcmQpOyBmYWxsYmFjazogMTg1IHMKICAgICAgICAgICAgICAgIHJldHJ5X2FmdGVy
echo ID0gaW50KHJlc3AuaGVhZGVycy5nZXQoIlJldHJ5LUFmdGVyIiwgU0xFRVBfQkVUV0VFTl9XSU5E
echo T1dTKSkgKyAyCiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygKICAgICAgICAgICAgICAg
echo ICAgICBmIkhUVFAgNDI5IOKAlCByYXRlIGxpbWl0LCBjemVrYW0ge3JldHJ5X2FmdGVyfXMgIgog
echo ICAgICAgICAgICAgICAgICAgIGYiKHByw7NiYSB7YXR0ZW1wdH0vNSkuLi4iCiAgICAgICAgICAg
echo ICAgICApCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKHJldHJ5X2FmdGVyKQogICAgICAgICAg
echo ICAgICAgY29udGludWUKICAgICAgICAgICAgc2VsZi5fcmFpc2VfZm9yX3N0YXR1cyhyZXNwLCBm
echo IkLFgsSFZCB6YXB5dGFuaWEgbyBmYWt0dXJ5IChvZmZzZXQ9e3BhZ2Vfb2Zmc2V0fSwgb2Q9e2Rh
echo dGVfZnJvbX0pIikKICAgICAgICAgICAgZGF0YSA9IHJlc3AuanNvbigpCiAgICAgICAgICAgIHJl
echo dHVybiBkYXRhCiAgICAgICAgcmFpc2UgS1NlRkludm9pY2VFcnJvcigKICAgICAgICAgICAgZiJC
echo xYLEhWQgemFweXRhbmlhIG8gZmFrdHVyeSAob2Zmc2V0PXtwYWdlX29mZnNldH0sIG9kPXtkYXRl
echo X2Zyb219KSAiCiAgICAgICAgICAgIGYi4oCUIHByemVrcm9jem9ubyBsaW1pdCBwcsOzYiIKICAg
echo ICAgICApCgogICAgZGVmIF9mZXRjaF93aW5kb3coc2VsZiwgc3ViamVjdF90eXBlOiBzdHIsIGRh
echo dGVfZnJvbTogc3RyLCBkYXRlX3RvOiBzdHIpIC0+IGxpc3RbZGljdF06CiAgICAgICAgIiIiUG9i
echo aWVyYSB3c3p5c3RraWUgc3Ryb255IGRsYSBqZWRuZWdvIG9rbmEgY3phc293ZWdvIChtYXggMyBt
echo aWVzacSFY2UpLiIiIgogICAgICAgIGxhYmVsID0gU1VCSkVDVF9UWVBFX0xBQkVMUy5nZXQoc3Vi
echo amVjdF90eXBlLCBzdWJqZWN0X3R5cGUpCiAgICAgICAgYWxsX2ludm9pY2VzID0gW10KICAgICAg
echo ICBvZmZzZXQgPSAwCgogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIGRhdGEgPSBzZWxm
echo Ll9xdWVyeV9wYWdlKHN1YmplY3RfdHlwZSwgZGF0ZV9mcm9tLCBkYXRlX3RvLCBvZmZzZXQpCiAg
echo ICAgICAgICAgIGludm9pY2VzID0gZGF0YS5nZXQoImludm9pY2VzIiwgW10pICAjIEtTZUYgQVBJ
echo IDIuMDogcG9sZSAiaW52b2ljZXMiCgogICAgICAgICAgICBpZiBpbnZvaWNlcyBhbmQgb2Zmc2V0
echo ID09IDA6CiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIiAgT2tubyB7ZGF0ZV9mcm9tWzox
echo MF194oCTe2RhdGVfdG9bOjEwXX06IHpuYWxlemlvbm8gZmFrdHVyeSAoe2xhYmVsfSkiKQoKICAg
echo ICAgICAgICAgaWYgbm90IGludm9pY2VzOgogICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAg
echo ICAgIGZvciBpbnYgaW4gaW52b2ljZXM6CiAgICAgICAgICAgICAgICBpbnZbIl90eXAiXSA9IGxh
echo YmVsCgogICAgICAgICAgICBhbGxfaW52b2ljZXMuZXh0ZW5kKGludm9pY2VzKQogICAgICAgICAg
echo ICBvZmZzZXQgKz0gbGVuKGludm9pY2VzKQoKICAgICAgICAgICAgIyBLU2VGIEFQSSAyLjA6IHBh
echo Z2luYWNqYSBwcnpleiBoYXNNb3JlIChuaWUgdG90YWxDb3VudCkKICAgICAgICAgICAgaWYgbm90
echo IGRhdGEuZ2V0KCJoYXNNb3JlIiwgRmFsc2UpOgogICAgICAgICAgICAgICAgYnJlYWsKCiAgICAg
echo ICAgICAgIHRpbWUuc2xlZXAoMC4zKSAgIyBtacSZZHp5IHN0cm9uYW1pIHBhZ2luYWNqaSAobGlt
echo aXQgOCByZXEvcyBqZXN0IE9LKQoKICAgICAgICByZXR1cm4gYWxsX2ludm9pY2VzCgogICAgQHN0
echo YXRpY21ldGhvZAogICAgZGVmIF9jb3VudF93aW5kb3dzKGR0X2Zyb206IGRhdGV0aW1lLCBkdF90
echo bzogZGF0ZXRpbWUpIC0+IGludDoKICAgICAgICBjb3VudCA9IDAKICAgICAgICBzdGFydCA9IGR0
echo X2Zyb20KICAgICAgICB3aGlsZSBzdGFydCA8PSBkdF90bzoKICAgICAgICAgICAgZW5kID0gbWlu
echo KHN0YXJ0ICsgcmVsYXRpdmVkZWx0YShtb250aHM9MykgLSB0aW1lZGVsdGEoZGF5cz0xKSwgZHRf
echo dG8pCiAgICAgICAgICAgIGNvdW50ICs9IDEKICAgICAgICAgICAgc3RhcnQgPSBlbmQgKyB0aW1l
echo ZGVsdGEoZGF5cz0xKQogICAgICAgIHJldHVybiBjb3VudAoKICAgIGRlZiBmZXRjaF9hbGwoc2Vs
echo Ziwgc3ViamVjdF90eXBlOiBzdHIsIGRhdGVfZnJvbTogc3RyLCBkYXRlX3RvOiBzdHIpIC0+IGxp
echo c3RbZGljdF06CiAgICAgICAgIiIiCiAgICAgICAgUG9iaWVyYSB3c3p5c3RraWUgZmFrdHVyeSB3
echo IHpha3Jlc2llIGRhdCwgYXV0b21hdHljem5pZSBkemllbMSFYwogICAgICAgIG5hIG9rbmEgMy1t
echo aWVzacSZY3puZSAobGltaXQgQVBJOiAyMCByZXEvaCkuCiAgICAgICAgTWnEmWR6eSBva25hbWkg
echo Y3pla2EgU0xFRVBfQkVUV0VFTl9XSU5ET1dTIHNla3VuZC4KICAgICAgICAiIiIKICAgICAgICBs
echo YWJlbCA9IFNVQkpFQ1RfVFlQRV9MQUJFTFMuZ2V0KHN1YmplY3RfdHlwZSwgc3ViamVjdF90eXBl
echo KQoKICAgICAgICBkdF9mcm9tID0gZGF0ZXRpbWUuc3RycHRpbWUoZGF0ZV9mcm9tWzoxMF0sICIl
echo WS0lbS0lZCIpCiAgICAgICAgZHRfdG8gICA9IGRhdGV0aW1lLnN0cnB0aW1lKGRhdGVfdG9bOjEw
echo XSwgICAiJVktJW0tJWQiKQoKICAgICAgICB0b3RhbF93aW5kb3dzID0gc2VsZi5fY291bnRfd2lu
echo ZG93cyhkdF9mcm9tLCBkdF90bykKICAgICAgICBldGFfbWluID0gKHRvdGFsX3dpbmRvd3MgKiBT
echo TEVFUF9CRVRXRUVOX1dJTkRPV1MpIC8vIDYwCgogICAgICAgIGxvZ2dlci5pbmZvKGYiUG9iaWVy
echo YW5pZSBmYWt0dXI6IHtsYWJlbH0iKQogICAgICAgIGxvZ2dlci5pbmZvKAogICAgICAgICAgICBm
echo Ilpha3Jlczoge2RhdGVfZnJvbVs6MTBdfSDihpIge2RhdGVfdG9bOjEwXX0gfCAiCiAgICAgICAg
echo ICAgIGYie3RvdGFsX3dpbmRvd3N9IG9raWVuIDMtbWllc2nEmWN6bnljaCB8ICIKICAgICAgICAg
echo ICAgZiJzemFjLiBjemFzOiB+e2V0YV9taW59IG1pbiIKICAgICAgICApCgogICAgICAgIGFsbF9p
echo bnZvaWNlcyA9IFtdCiAgICAgICAgd2luZG93X3N0YXJ0ID0gZHRfZnJvbQogICAgICAgIHdpbmRv
echo d19udW0gICA9IDAKCiAgICAgICAgd2hpbGUgd2luZG93X3N0YXJ0IDw9IGR0X3RvOgogICAgICAg
echo ICAgICB3aW5kb3dfbnVtICs9IDEKICAgICAgICAgICAgd2luZG93X2VuZCA9IG1pbih3aW5kb3df
echo c3RhcnQgKyByZWxhdGl2ZWRlbHRhKG1vbnRocz0zKSAtIHRpbWVkZWx0YShkYXlzPTEpLCBkdF90
echo bykKCiAgICAgICAgICAgIHdfZnJvbSA9IHNlbGYudG9faXNvKHdpbmRvd19zdGFydC5kYXRlKCks
echo IGVuZF9vZl9kYXk9RmFsc2UpCiAgICAgICAgICAgIHdfdG8gICA9IHNlbGYudG9faXNvKHdpbmRv
echo d19lbmQuZGF0ZSgpLCAgIGVuZF9vZl9kYXk9VHJ1ZSkKCiAgICAgICAgICAgIGJhdGNoID0gc2Vs
echo Zi5fZmV0Y2hfd2luZG93KHN1YmplY3RfdHlwZSwgd19mcm9tLCB3X3RvKQogICAgICAgICAgICBh
echo bGxfaW52b2ljZXMuZXh0ZW5kKGJhdGNoKQoKICAgICAgICAgICAgd2luZG93X3N0YXJ0ID0gd2lu
echo ZG93X2VuZCArIHRpbWVkZWx0YShkYXlzPTEpCgogICAgICAgICAgICBpZiB3aW5kb3dfc3RhcnQg
echo PD0gZHRfdG86CiAgICAgICAgICAgICAgICByZW1haW5pbmdfd2luZG93cyA9IHRvdGFsX3dpbmRv
echo d3MgLSB3aW5kb3dfbnVtCiAgICAgICAgICAgICAgICByZW1haW5pbmdfbWluICAgICA9IChyZW1h
echo aW5pbmdfd2luZG93cyAqIFNMRUVQX0JFVFdFRU5fV0lORE9XUykgLy8gNjAKICAgICAgICAgICAg
echo ICAgIGxvZ2dlci5pbmZvKAogICAgICAgICAgICAgICAgICAgIGYiICBbe3dpbmRvd19udW19L3t0
echo b3RhbF93aW5kb3dzfV0gQ3pla2FtIHtTTEVFUF9CRVRXRUVOX1dJTkRPV1N9cyAiCiAgICAgICAg
echo ICAgICAgICAgICAgZiIobGltaXQgMjAgcmVxL2gpIOKAlCBwb3pvc3RhxYJvIH57cmVtYWluaW5n
echo X21pbn0gbWluLi4uIgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgdGltZS5zbGVl
echo cChTTEVFUF9CRVRXRUVOX1dJTkRPV1MpCgogICAgICAgIGxvZ2dlci5pbmZvKGYi4pyTIMWBxIVj
echo em5pZSBwb2JyYW5vOiB7bGVuKGFsbF9pbnZvaWNlcyl9IGZha3R1ciAoe2xhYmVsfSkiKQogICAg
echo ICAgIHJldHVybiBhbGxfaW52b2ljZXMKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgdG9faXNv
echo KGQ6IHN0ciB8IGRhdGUgfCBkYXRldGltZSwgZW5kX29mX2RheTogYm9vbCA9IEZhbHNlKSAtPiBz
echo dHI6CiAgICAgICAgaWYgaXNpbnN0YW5jZShkLCBzdHIpOgogICAgICAgICAgICBkID0gZGF0ZXRp
echo bWUuc3RycHRpbWUoZFs6MTBdLCAiJVktJW0tJWQiKS5kYXRlKCkKICAgICAgICBpZiBpc2luc3Rh
echo bmNlKGQsIGRhdGUpIGFuZCBub3QgaXNpbnN0YW5jZShkLCBkYXRldGltZSk6CiAgICAgICAgICAg
echo IGlmIGVuZF9vZl9kYXk6CiAgICAgICAgICAgICAgICBkID0gZGF0ZXRpbWUoZC55ZWFyLCBkLm1v
echo bnRoLCBkLmRheSwgMjMsIDU5LCA1OSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAg
echo IGQgPSBkYXRldGltZShkLnllYXIsIGQubW9udGgsIGQuZGF5LCAwLCAwLCAwKQogICAgICAgIHJl
echo dHVybiBkLnN0cmZ0aW1lKCIlWS0lbS0lZFQlSDolTTolUy4wMDBaIikKCiAgICBAc3RhdGljbWV0
echo aG9kCiAgICBkZWYgX3JhaXNlX2Zvcl9zdGF0dXMocmVzcDogcmVxdWVzdHMuUmVzcG9uc2UsIGNv
echo bnRleHQ6IHN0cikgLT4gTm9uZToKICAgICAgICBpZiBub3QgcmVzcC5vazoKICAgICAgICAgICAg
echo dHJ5OgogICAgICAgICAgICAgICAgZGV0YWlsID0gcmVzcC5qc29uKCkKICAgICAgICAgICAgZXhj
echo ZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGRldGFpbCA9IHJlc3AudGV4dFs6NTAwXQog
echo ICAgICAgICAgICByYWlzZSBLU2VGSW52b2ljZUVycm9yKGYie2NvbnRleHR9IOKAlCBIVFRQIHty
echo ZXNwLnN0YXR1c19jb2RlfToge2RldGFpbH0iKQo=
) > "%TEMP%\ksef_invoices.b64"
certutil -decode "%TEMP%\ksef_invoices.b64" "!INSTALL_DIR!\ksef_invoices.py" >nul 2>&1
del "%TEMP%\ksef_invoices.b64"
echo    Wyodrebniono: ksef_invoices.py

:: --- requirements.txt ---
(
echo cmVxdWVzdHM9PTIuMzIuMwpjcnlwdG9ncmFwaHk9PTQzLjAuMwpweXRob24tZG90ZW52PT0xLjAu
echo MQpvcGVucHl4bD09My4xLjUKcHl0aG9uLWRhdGV1dGlsPT0yLjkuMAo=
) > "%TEMP%\ksef_req.b64"
certutil -decode "%TEMP%\ksef_req.b64" "!INSTALL_DIR!\requirements.txt" >nul 2>&1
del "%TEMP%\ksef_req.b64"
echo    Wyodrebniono: requirements.txt

:: --- .env.example ---
(
echo IyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojIEtTZUYg
echo QVBJIDIuMCDigJQgS29uZmlndXJhY2phCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
echo LS0tLS0tLS0tLS0tLS0tLS0KCiMgTklQIGZpcm15IChiZXoga3Jlc2VrLCB0eWxrbyBjeWZyeSkK
echo S1NFRl9OSVA9MTIzNDU2Nzg5MAoKIyBUb2tlbiBLU2VGIHd5Z2VuZXJvd2FueSB3IE1vZHVsZSBD
echo ZXJ0eWZpa2F0w7N3IGkgVXByYXduaWXFhAojIGh0dHBzOi8va3NlZi5wb2RhdGtpLmdvdi5wbCDi
echo hpIgTW9kdcWCIENlcnR5ZmlrYXTDs3cgaSBVcHJhd25pZcWEIOKGkiBUb2tlbnkKS1NFRl9UT0tF
echo Tj1UVVRBSl9XS0xFSl9TV09KX1RPS0VOX0tTRUYKCiMgxZpyb2Rvd2lza286IHRlc3QgfCBwcm9k
echo CiMgdGVzdCA9IGh0dHBzOi8vYXBpLXRlc3Qua3NlZi5tZi5nb3YucGwgIChiZXpwaWVjem5lLCDF
echo m3JvZG93aXNrbyB0ZXN0b3dlKQojIHByb2QgPSBodHRwczovL2FwaS5rc2VmLm1mLmdvdi5wbCAg
echo ICAgICAgKHByb2R1a2NqYSDigJQgYWt0eXduYSBvZCAwMi4yMDI2KQpLU0VGX0VOVj10ZXN0Cgoj
echo IFpha3JlcyBkYXQgZG8gcG9icmFuaWEgZmFrdHVyIChmb3JtYXQ6IFlZWVktTU0tREQpCkRBVEVf
echo RlJPTT0yMDI1LTAxLTAxCkRBVEVfVE89MjAyNS0xMi0zMQoKIyBMaWN6YmEgZmFrdHVyIG5hIHN0
echo cm9uxJkgKDHigJMxMDAwKQpQQUdFX1NJWkU9MTAwCg==
) > "%TEMP%\ksef_envex.b64"
certutil -decode "%TEMP%\ksef_envex.b64" "!INSTALL_DIR!\.env.example" >nul 2>&1
del "%TEMP%\ksef_envex.b64"
echo    Wyodrebniono: .env.example

echo    OK

:: ---------------------------------------------------------------
:: 4. Srodowisko wirtualne
:: ---------------------------------------------------------------
echo.
echo [3/5] Tworzenie srodowiska wirtualnego (venv)...
if exist "!INSTALL_DIR!\venv" (
    echo    venv juz istnieje -- pomijam tworzenie.
) else (
    python -m venv "!INSTALL_DIR!\venv"
    if %errorlevel% neq 0 (
        echo    BLAD: Nie mozna utworzyc venv.
        pause
        exit /b 1
    )
    echo    OK
)

:: ---------------------------------------------------------------
:: 5. Instalacja zaleznosci
:: ---------------------------------------------------------------
echo.
echo [4/5] Instalacja zaleznosci (pip install -r requirements.txt)...
"!INSTALL_DIR!\venv\Scripts\pip" install --upgrade pip -q
"!INSTALL_DIR!\venv\Scripts\pip" install -r "!INSTALL_DIR!\requirements.txt"
if %errorlevel% neq 0 (
    echo.
    echo    BLAD: Instalacja zaleznosci nie powiodla sie.
    pause
    exit /b 1
)
echo    OK

:: ---------------------------------------------------------------
:: 6. Plik .env
:: ---------------------------------------------------------------
echo.
echo [5/5] Przygotowanie pliku konfiguracyjnego (.env)...
if exist "!INSTALL_DIR!\.env" (
    echo    Plik .env juz istnieje -- nie nadpisuje.
) else (
    copy /Y "!INSTALL_DIR!\.env.example" "!INSTALL_DIR!\.env" >nul
    echo    Utworzono .env z szablonu .env.example
)
echo    OK

:: ---------------------------------------------------------------
:: Skrypt uruchomieniowy
:: ---------------------------------------------------------------
echo.
echo Tworzenie skryptu uruchomieniowego (uruchom.bat)...
(
    echo @echo off
    echo chcp 65001 ^>nul
    echo cd /d "!INSTALL_DIR!"
    echo echo Uruchamianie KSeF API 2.0...
    echo echo.
    echo "!INSTALL_DIR!\venv\Scripts\python" "!INSTALL_DIR!\main.py"
    echo echo.
    echo pause
) > "!INSTALL_DIR!\uruchom.bat"
echo    OK

:: ---------------------------------------------------------------
:: Podsumowanie
:: ---------------------------------------------------------------
echo.
echo ===============================================================
echo   Instalacja zakonczona pomyslnie!
echo ===============================================================
echo.
echo   Katalog: !INSTALL_DIR!
echo.
echo   NASTEPNY KROK -- uzupelnij plik konfiguracyjny:
echo   !INSTALL_DIR!\.env
echo.
echo   Wymagane wartosci w .env:
echo     KSEF_NIP    = NIP firmy (bez kresek)
echo     KSEF_TOKEN  = Token KSeF (uprawnienie: InvoiceRead)
echo     KSEF_ENV    = prod  (lub test dla srodowiska testowego)
echo     DATE_FROM   = np. 2026-01-01
echo     DATE_TO     = np. 2026-12-31
echo.
echo   Uruchomienie po konfiguracji:
echo     !INSTALL_DIR!\uruchom.bat
echo   lub:
echo     !INSTALL_DIR!\venv\Scripts\python !INSTALL_DIR!\main.py
echo.
echo ===============================================================

set /p "OPEN_ENV=Otworzyc plik .env w Notatniku teraz? [T/n]: "
if /i "!OPEN_ENV!"=="" set "OPEN_ENV=T"
if /i "!OPEN_ENV!"=="T" notepad "!INSTALL_DIR!\.env"

pause